<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Application.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Application.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//TODO: gameHandler qui s'occupe de DragNDropHandler et MouseClickHandler et cleanup les requetes (bessoin de finir les règles côté serveur d'abord)
//DONE: début de gameHandler, fini timer et notifications

/**
 * Class controlling the different tab of the application.
 * The application is divided in 3 (4 counting the doc) "tab".
 * This class is used to switch between tab and to initialize everything the tabs
 * need in order to run.
 * Can be considered as the "main" object running the application.
 * @property {Object} remote Allow the use of module from the main process in the renderer process
 * @property {Settings} settings Settings of the application
 * @property {String} currentTab String containing the name of the tab currently loaded
 * @property {module} handler Module handling the current tab
 * @property {jQuery} tabContainer DOM element on which the tab is append to
 * @property {Array} windows Array of BrowserWindow containing all the windows of the app (app &amp; doc)
 * @property {jQuery} loader DOM element used to display while the tab is being loaded
 * @property {Object} json Object of the last/current game request to the server
 * @property {Sring} gameId Id of the client on the server
 * @property {String} formulaId Id of which formula the game is using (currently not used properly)
 * @property {Countdown} countdown Countdown object of the game (used to keep an eye on the countdown and not having multiple wountdown running at the same time)
 * @property {Application} instance Reference to the only instance of Application
 */
class Application {

	/**
   * There can be only one instance of Application, if no instance exist a new one
   * is created, if one instance already exist then it's the one returned.
   */
  constructor () {
    if (!Application.instance) {
			const Settings = require('./Settings')
      //Reference to electron
      this.remote = require('electron').remote;
      //Application settings
      this.settings = Settings.useDefault();
      //Name of the tab the app is currently on (GAME by default)
      this.currentTab = "GAME";
			//Module handling the current tab
			this.handler = null
      //Main dom element who contain the tab content
      this.tabContainer = $(".main");
      //Array containing the app windows (app &amp; doc)
      this.windows = this.remote.getGlobal("windowsArray");
      //Dom element of the spinner used during tab loading
      this.loader = $("&lt;div>&lt;/div>").addClass("spinner");
      //Json object of the last/current game request to the server
      this.json = null;
      //Id of the client on the server
      this.gameId = null;
      //Id of which formula the game is using
      this.formulaId = "1";
      //State of the countdown
      Application.countdown = null;
      //Only instance of Application
      Application.instance = this;
    }

    return Application.instance;
  }

  /**
   * Send a request to get an html file, and change the active tab.
   * Used to get the diffrent html file composing the app "tabs".
   * Call loadHtml() when completed.
   * @param {String} string Name of the request (in this case it's also the name of the tab)
   */
  requestHtml (string) {
		const Request = require('./Request')

    var request = Request.buildRequest(string, this.loadHtml)

    $('.main').html(this.loader)

    request.send()

    this.currentTab = string
  }

  /**
   * Callback function of the requestHtml request.
   * Load the html file recieved onto the main element.
   * @param {Object} response response from the request (jQuery ajax response)
   * @param {String} status response status from the request
   */
  loadHtml (response, status) {
		//Need to use this since in the context when the function is called "this" reference the request object and not the application object
		const instance = require('./Application')

    if (status != "success")
      instance.displayErrorNotification(".main", "Erreur lors du chargment de la page, status : " + status + " (" + response.status + ").")

    var htmlpage = $(response.responseText);
    $(".main").hide();
    $(".main").html("");
    $(".main").append(htmlpage);
		$(".main").show();

    console.log("[CLIENT]: Tab " + instance.currentTab + " loaded");


    instance.setNavbarActive();
    instance.loaded();
		instance.loadHandler();
  }

  /**
   * Control the active tab of the navbar header.
   * Remove the old active element and set the element with the id string to active.
   */
  setNavbarActive () {
    var id = this.currentTab.toLowerCase();
    $("#" + id).parent().find("button").removeClass("sidebar-button-active");
    $("#" + id).addClass("sidebar-button-active");
  }

  /**
   * Called when the tab is loaded.
   * Initialize everything the tab need in order to run,
   * also apply the settings to the tab newly loaded.
   */
  loaded () {
    if (this.currentTab == "GAME") {
			const gameHandler = require('./gameHandler')
      gameHandler.typesetMath();
		}
    else if (this.currentTab == "SETTINGS") {
			const settingsHandler = require ('./settingsHandler')
      settingsHandler.setEvents();
      settingsHandler.setValues();
    }

    this.settings.applySettings();
  }

	loadHandler () {
		const EnumHelper = require('./EnumHelper')

		for (var i in EnumHelper.TABS)
			console.log(EnumHelper.TABS[i].name)
	}

  /**
   * Return the only instance of Application.
   * @static
   */
  static getInstance () {
    return Application.instance;
  }

  /**
   * Toggle chromium dev tools on the app window.
   */
  toggleDevTools() {
    this.windows["app"].webContents.toggleDevTools({mode: 'bottom'});
  }

  /**
   * Send a message/event to the main process to display the documentation
   */
  displayDoc () {
    const {ipcRenderer} = require('electron');
    ipcRenderer.send('display-doc');
  }

  /**
   * Display an error notification.
   * Call displayNotification who handle the creation and display of the
   * notification.
   * @param {String} element identifier of the dom element who will append the notification
   * @param {String} message message to be displayed on the notification
   */
  displayErrorNotification (element, message) {
    this.displayNotification(element, message, "danger");
  }

  /**
   * Display a success notification.
   * Call displayNotification who handle the creation and display of the
   * notification.
   * @param {String} element identifier of the dom element who will append the notification
   * @param {String} message message to be displayed on the notification
   */
  displaySuccessNotification (element, message) {
    this.displayNotification (element, message, "success");
  }

  /**
   * Display a notification.
   * Create the notification of type type and message message and append it to
   * the DOM element element.
   * Create a dismissible notification that won't close unless the user close it.
   * If autoCloseNotif is true the notif will close automatically in notifTimer milliseconds.
   * If a notification was already present in the DOM element it will be replaced.
   * @param {String} element identifier of the DOM element who will append the notification
   * @param {String} message message to be displayed on the notification
   * @param {String} type type of the notification (error, success ...) correspond to bootsrap 4 color (danger, warning, success and info)
   */
  displayNotification (element, message, type) {
    $(element).children(".notif").hide("fast", () => {
      $(this).remove();
    });

    var notification = $("&lt;div>&lt;/div>").addClass("notif").addClass("alert").addClass("alert-" + type).addClass("alert-dismissible").attr("role", "alert").css("display", "none").text(message);
    $("&lt;span>&lt;/span>").addClass("glyphicon").addClass("glyphicon-remove").attr("aria-hidden", "true").appendTo($("&lt;button>&lt;/button>").addClass("close").attr("data-dismiss", "alert").appendTo(notification));
    notification.appendTo(element).show("fast");

    if (this.settings.autoCloseNotif)
      setTimeout(() => {
        $(element).children(".notif").hide("fast", () => {
          $(this).remove();
        });
      }, this.settings.notifTimer);
  }

  /**
   * Return the memory usage of this process.
   * Return only the memory usage of the renderer process and not the main process.
   * @returns {Object} memory usage object
   */
  getMemoryUsage () {
    return this.remote.process.getProcessMemoryInfo();
  }

  /**
   * Return the process object (renderer process).
   * @returns {Object} process object
   */
  getProcess () {
    return this.remote.process;
  }

	test () {
		$('.j1').animateCss('slideInDown', 0.5)
		$('.j2').animateCss('slideInDown', 0.5, 0.1)
		$('.j3').animateCss('slideInDown', 0.5, 0.2)
	}
}

module.exports = new Application()
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-countdown.html">countdown</a></li><li><a href="module-dragNDropHandler.html">dragNDropHandler</a></li><li><a href="module-enumHelper.html">enumHelper</a></li><li><a href="module-gameHandler.html">gameHandler</a></li><li><a href="module-mouseClickHandler.html">mouseClickHandler</a></li><li><a href="module-request.html">request</a></li><li><a href="module-settings.html">settings</a></li><li><a href="module-settingsHandler.html">settingsHandler</a></li></ul><h3>Classes</h3><ul><li><a href="Application.html">Application</a></li><li><a href="Countdown.html">Countdown</a></li><li><a href="Request.html">Request</a></li><li><a href="Settings.html">Settings</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Global">Global</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Wed Mar 08 2017 15:31:00 GMT+0100 (Paris, Madrid)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
